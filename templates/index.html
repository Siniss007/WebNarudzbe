<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aplikacija za narudžbe</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
h1 { text-align: center; color: #333; }
form { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
input, select { padding: 5px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; }
button { padding: 6px 12px; border: none; border-radius: 4px; background-color: #28a745; color: white; cursor: pointer; font-weight: bold; }
button:hover { background-color: #218838; }
table { width: 100%; border-collapse: collapse; background-color: white; border-radius: 8px; overflow: hidden; }
th, td { padding: 10px; text-align: center; border-bottom: 1px solid #ddd; }
th { background-color: #343a40; color: white; }
tr:hover { background-color: #f1f1f1; }
.expired { background-color: #FF6961; }
.urgent { background-color: #FFB347; }
.soon { background-color: #FFD700; }
.normal { background-color: #ADD8E6; }
.done { background-color: #d3d3d3; }
fieldset { margin-top: 15px; padding: 10px; }
legend { font-weight: bold; }
.action-form { display:inline; margin:0 2px; }
.delete-btn { background-color: #dc3545; }
.delete-btn:hover { background-color: #c82333; }
.edit-btn { background-color: #007bff; color:white; }
.edit-btn:hover { background-color: #0069d9; }
.totals { margin-top: 20px; background-color:#fff; padding:10px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color:#fefefe; margin:15% auto; padding:20px; border:1px solid #888; width:300px; border-radius:8px; }
.close { color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer; }
.close:hover, .close:focus { color:black; }
</style>
</head>
<body>
<h1>Aplikacija za narudžbe – Fabrika stočne hrane</h1>

<form action="/add" method="POST">
    <input type="text" name="kupac" placeholder="Kupac/Farma" required>
    <input type="text" name="vrsta" placeholder="Vrsta hrane" required>
    <input type="number" step="0.01" name="kolicina" placeholder="Količina (kg)" required>
    <input type="text" name="datum" placeholder="Datum isporuke (dd.mm.yyyy.)" required>
    <input type="text" name="napomena" placeholder="Napomena">
    <button type="submit">Dodaj narudžbu</button>
</form>

<table>
<thead>
<tr>
<th>Kupac/Farma</th>
<th>Datum isporuke</th>
<th>Vrsta hrane</th>
<th>Količina (kg)</th>
<th>Napomena</th>
<th>Akcija</th>
</tr>
</thead>
<tbody>
{% for order in orders %}
<tr class="{{ order.tag }}">
<td>{{ order.kupac }}</td>
<td>{{ order.datum }}</td>
<td>{{ order.vrsta }}</td>
<td>{{ order.kolicina }}</td>
<td>{{ order.napomena }}</td>
<td>
<button class="edit-btn" onclick="openModal('{{ order.id }}','{{ order.kupac }}','{{ order.vrsta }}','{{ order.kolicina }}','{{ order.datum }}','{{ order.napomena }}')">Uredi</button>

<form action="/mark_done" method="POST" class="action-form">
<input type="hidden" name="done_id" value="{{ order.id }}">
<button type="submit">Završeno</button>
</form>

<form action="/delete" method="POST" class="action-form">
<input type="hidden" name="delete_id" value="{{ order.id }}">
<button type="submit" class="delete-btn">Obriši</button>
</form>
</td>
</tr>
{% endfor %}
</tbody>
</table>

<fieldset class="totals">
<legend>Ukupne količine hrane (aktivne narudžbe):</legend>
<ul>
{% for food, qty in totals.items() %}
<li>{{ food }}: {{ qty }} kg</li>
{% endfor %}
</ul>
</fieldset>

<fieldset>
<legend>Legenda boja:</legend>
<ul>
<li style="color:#FF6961;">Crveno = Prošlo</li>
<li style="color:#FFB347;">Narandžasto = Hitno (&lt;4 dana)</li>
<li style="color:#FFD700;">Žuto = Uskoro (≤7 dana)</li>
<li style="color:#ADD8E6;">Plavo = Normalno</li>
<li style="color:#d3d3d3;">Sivo = Završeno</li>
</ul>
</fieldset>

<!-- Modal -->
<div id="editModal" class="modal">
<div class="modal-content">
<span class="close" onclick="closeModal()">&times;</span>
<h3>Uredi narudžbu</h3>
<form action="/edit" method="POST">
<input type="hidden" id="id_edit" name="id_edit">
<label>Kupac/Farma:</label>
<input type="text" id="kupac_edit" name="kupac_edit" required><br><br>
<label>Vrsta hrane:</label>
<input type="text" id="vrsta_edit" name="vrsta_edit" required><br><br>
<label>Količina (kg):</label>
<input type="number" step="0.01" id="kolicina_edit" name="kolicina_edit" required><br><br>
<label>Datum isporuke:</label>
<input type="text" id="datum_edit" name="datum_edit" required><br><br>
<label>Napomena:</label>
<input type="text" id="napomena_edit" name="napomena_edit"><br><br>
<button type="submit">Spremi</button>
</form>
</div>
</div>

<script>
function openModal(id, kupac, vrsta, kolicina, datum, napomena) {
document.getElementById('id_edit').value = id;
document.getElementById('kupac_edit').value = kupac;
document.getElementById('vrsta_edit').value = vrsta;
document.getElementById('kolicina_edit').value = kolicina;
document.getElementById('datum_edit').value = datum;
document.getElementById('napomena_edit').value = napomena;
document.getElementById('editModal').style.display = "block";
}
function closeModal() {
document.getElementById('editModal').style.display = "none";
}
window.onclick = function(event) {
if (event.target == document.getElementById('editModal')) {
closeModal();
}
}
</script>

</body>
</html>
